{"version":3,"file":"version_manager.js","sources":["src/minecraft/version_manager.js"],"sourcesContent":["const download = require('download-file');\r\nconst got = require('got');\r\nconst jetpack = require('fs-jetpack');\r\nconst jsonfile = require('jsonfile');\r\n\r\nconst config = require('../config');\r\nconst URL = \"https://launchermeta.mojang.com/mc/game/version_manifest.json\";\r\nconst TIMEOUT = 10000 // 10 seconds\r\n\r\nconst Version = require('./version').Version;\r\n\r\nvar path;\r\nvar versionList;\r\nvar versionsInstalled;\r\n\r\nexports.init = function() {\r\n\r\n\t// Save the path\r\n\tpath = config.minecraftPath().path('versions');\r\n\r\n\t// Download versions\r\n\texports.downloadVersionList();\r\n\texports.loadInstalledVersions();\r\n\r\n\t// Return success\r\n\treturn true;\r\n};\r\n\r\nexports.downloadVersionList = function() {\r\n\tgot.get(URL, {\r\n\t\tjson: true,\r\n\t\ttimeout: TIMEOUT\r\n\t}).then(response => {\r\n\t\tversionList = response.body;\r\n\t\tconsole.log(\"The version is\", versionList.latest);\r\n\t}); \r\n};\r\n\r\nexports.versions = function(options) {\r\n\t\r\n};\r\n\r\nexports.versionsInstalled = function() {\r\n\treturn versionsInsalled;\r\n};\r\n\r\nexports.loadVersion = function(version, callback) {\r\n\r\n\t// Check if the version is not installed\r\n\tif (versionsInstalled.indexOf(version) == -1) {\r\n\t\tfor (var i = 0; i < versionList.versions.length; i++) {\r\n\t\t\tif (versionList.versions[i].id == version) {\r\n\t\t\t\texports.installVersion(versionList.versions[i], callback);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log(\"ERROR: Can't find version\", version);\r\n\t\treturn;\r\n\t}\r\n\tconsole.log(\"The version exists!\");\r\n};\r\n\r\nexports.loadInstalledVersions = function() {\r\n\tversionsInstalled = [];\r\n\tvar versionsDir = jetpack.cwd(path);\r\n\tvar folders = versionsDir.list();\r\n\tvar file;\r\n\tfor (var i = 0; i < folders.length; i++) {\r\n\t\tfile = versionsDir.cwd(folders[i]).path(folders[i] + '.json');\r\n\t\tif (file)\r\n\t\t\tversionsInstalled.push(file);\r\n\t}\r\n};\r\n\r\nexports.installVersion = function(version, callback) {\r\n\r\n\tconsole.log(\"Downloading version:\", version.id, version.url);\r\n\r\n\t// Download location\r\n\tvar dir = jetpack.cwd(path).cwd(version.id);\r\n\tjetpack.dir(dir.path());\r\n\t// Download the file\r\n\tgot(version.url, {\r\n\t\tjson: true\r\n\t}).then(response => {\r\n\t\tjsonfile.writeFile(dir.path(version.id + '.json'), response.body, (error) => {\r\n\t\t\tif (error)\r\n\t\t\t\tconsole.error(\"ERROR: Failed to download Minecraft version:\", version.id);\r\n\t\t\telse {\r\n\t\t\t\tconsole.log(`Minecraft ${version.id} installed successfully!`);\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t});\r\n\t}); \r\n};"],"names":[],"mappings":"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"}