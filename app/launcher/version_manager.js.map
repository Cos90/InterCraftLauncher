{"version":3,"file":"version_manager.js","sources":["src/launcher/version_manager.js"],"sourcesContent":["const download = require('download-file');\r\nconst got = require('got');\r\nconst jetpack = require('fs-jetpack');\r\nconst jsonfile = require('jsonfile');\r\n\r\nconst config = require('../config');\r\nconst URL = \"https://launchermeta.mojang.com/mc/game/version_manifest.json\";\r\nconst TIMEOUT = 10000 // 10 seconds\r\n\r\nconst Version = require('./version').Version;\r\n\r\nvar path;\r\nvar versionList;\r\nvar versionsInstalled;\r\n\r\nexports.init = function() {\r\n\r\n\t// Save the path\r\n\tpath = config.minecraftPath().path('versions');\r\n\r\n\t// Download versions\r\n\texports.downloadVersionList();\r\n\r\n\t// Return success\r\n\treturn true;\r\n};\r\n\r\nexports.downloadVersionList = function() {\r\n\tgot.get(URL, {\r\n\t\t'timeout': TIMEOUT\r\n\t})\r\n\t.then(response => {\r\n\t\tversionList = JSON.parse(response.body);\r\n\t\tconsole.log(\"The version is\", versionList.latest);\r\n\t}); \r\n};\r\n\r\nexports.versions = function(options) {\r\n\t\r\n};\r\n\r\nexports.versionsInstalled = function() {\r\n\tinstalledVersions = [];\r\n\tvar versionsDir = minecraftDir.cwd('versions');\r\n\tvar folders = versionsDir.list();\r\n\tvar file;\r\n\tfor (var i = 0; i < folders.length; i++) {\r\n\t\tfile = versionsDir.cwd(folders[i]).path(folders[i] + '.json');\r\n\t\tif (file)\r\n\t\t\tinstalledVersions.push(file);\r\n\t}\r\n\treturn installedVersions;\r\n};\r\n\r\nexports.loadVersion = function(version, callback) {\r\n\r\n\t// Check if the version is not installed\r\n\tif (exports.versionsInstalled.indexOf(version) == -1) {\r\n\t\tfor (var i = 0; i < versionList.versions.length; i++) {\r\n\t\t\tif (versionList.versions[i].id == version) {\r\n\t\t\t\texports.downloadVersion(versionList.versions[i]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log(\"ERROR: Can't find version\", version);\r\n\t\treturn;\r\n\t}\r\n\r\n\t\r\n};\r\n\r\nexports.downloadVersion = function(version, callback) {\r\n\r\n\tconsole.log(\"Downloading version:\", version.id);\r\n\r\n\t// Download location\r\n\tvar dir = jetpack.cwd(path).path(version.id);\r\n\r\n\t// Download the file\r\n\tdownload(\r\n\t\tversion.url,\r\n\t\t{'directory':  dir},\r\n\t\t(error) => {\r\n\t\t\tif (error)\r\n\t\t\t\tconsole.error(\"Error: Failed to download Minecraft version\", version.id);\r\n\t\t\telse\r\n\t\t\t\tconsole.log(\"Version downloaded\", version.id);\r\n\t\t}\r\n\t);\r\n};"],"names":[],"mappings":"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"}